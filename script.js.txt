// é¡Œåº«è³‡æ–™ï¼šæ‚¨å¯ä»¥ä¾æ­¤æ ¼å¼è‡ªç”±æ“´å……é¡Œç›®
const quizData = [
    {
        question: "åœ¨è‡ªè£½ç°¡æ˜“æº«åº¦è¨ˆçš„å¯¦é©—ä¸­ï¼Œç‚ºä»€éº¼è¦ä½¿ç”¨ã€Œç´°ç»ç’ƒç®¡ã€è€Œä¸æ˜¯ç²—ç»ç’ƒç®¡ï¼Ÿ",
        options: [
            "ç‚ºäº†ç¯€çœææ–™æˆæœ¬",
            "å› ç‚ºç´°ç»ç’ƒç®¡æ¯”è¼ƒä¸å®¹æ˜“ç ´è£‚",
            "ç®¡å¾‘è¶Šå°ï¼Œæ¶²é¢å‡é™è®ŠåŒ–è¶Šæ˜é¡¯ï¼Œå®¹æ˜“è§€å¯Ÿ",
            "ç´°ç»ç’ƒç®¡çš„ç†±å‚³å°æ•ˆæœæ¯”è¼ƒå¥½"
        ],
        correct: 2, // å°æ‡‰ options çš„ç´¢å¼• (0, 1, 2, 3)
        [cite_start]explanation: "æ ¹æ“šå¯¦é©—çµæœï¼Œç»ç’ƒç®¡çš„ç®¡å¾‘è¶Šå°ï¼Œæ°´ä½çš„é«˜ä½è®ŠåŒ–è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è§€å¯Ÿæº«åº¦çš„ç´°å¾®è®ŠåŒ– [cite: 85]ã€‚"
    },
    {
        question: "é—œæ–¼ã€Œç†±å¹³è¡¡ã€ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ",
        options: [
            "ç†±é‡æœƒç”±ç†±å«é‡é«˜çš„ç‰©é«”å‚³å‘ç†±å«é‡ä½çš„ç‰©é«”",
            "ç†±é‡æœƒç”±æº«åº¦é«˜çš„ç‰©é«”å‚³å‘æº«åº¦ä½çš„ç‰©é«”",
            "å…©ç‰©é«”é”ç†±å¹³è¡¡æ™‚ï¼Œå…¶å«æœ‰çš„ç†±é‡å¿…å®šç›¸ç­‰",
            "è³ªé‡è¶Šå¤§çš„ç‰©é«”ï¼Œæœ€çµ‚å¹³è¡¡æº«åº¦ä¸€å®šè¶Šé«˜"
        ],
        correct: 1,
        [cite_start]explanation: "ç†±èƒ½æœƒç”±ã€Œæº«åº¦é«˜ã€çš„ç‰©é«”å¾€ã€Œæº«åº¦ä½ã€çš„ç‰©é«”è½‰ç§»ï¼Œç›´åˆ°å…©è€…æº«åº¦ç›¸åŒï¼ˆç†±å¹³è¡¡ï¼‰ï¼Œè€Œéå–æ±ºæ–¼ç†±é‡å¤šå¯¡ [cite: 228, 251]ã€‚"
    },
    {
        question: "è‹¥ä¸€å¤§æ°£å£“ä¸‹ï¼Œæ°´çš„å†°é»ç‚º 32Â°Fï¼Œæ²¸é»ç‚º 212Â°Fã€‚è«‹å•æ”æ° 30Â°C ç­‰æ–¼è¯æ°å¹¾åº¦ï¼Ÿ",
        options: [
            "68Â°F",
            "86Â°F",
            "96Â°F",
            "100Â°F"
        ],
        correct: 1,
        [cite_start]explanation: "æ›ç®—å…¬å¼ç‚ºï¼šF = 9/5 Ã— C + 32ã€‚è¨ˆç®—ï¼š9/5 Ã— 30 + 32 = 54 + 32 = 86Â°F [cite: 214]ã€‚"
    },
    {
        question: "æ ¹æ“šæ¯”ç†±å…¬å¼ $H = M \\times S \\times \\Delta T$ï¼Œè‹¥ä½¿ç”¨åŒä¸€ç†±æºåŠ ç†±ï¼ˆæä¾›ç›¸åŒç†±é‡ Hï¼‰ï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ",
        options: [
            "è³ªé‡ M è¶Šå¤§ï¼Œæº«åº¦è®ŠåŒ– $\\Delta T$ è¶Šå¤§",
            "æ¯”ç†± S è¶Šå¤§ï¼Œæº«åº¦è®ŠåŒ– $\\Delta T$ è¶Šå°",
            "æº«åº¦è®ŠåŒ– $\\Delta T$ èˆ‡ è³ªé‡ M æˆæ­£æ¯”",
            "ç‰©è³ªç¨®é¡ä¸æœƒå½±éŸ¿æº«åº¦è®ŠåŒ–"
        ],
        correct: 1,
        [cite_start]explanation: "ç•¶ H å›ºå®šæ™‚ï¼ŒM Ã— S èˆ‡ $\\Delta T$ æˆåæ¯”ã€‚äº¦å³ï¼Œè³ªé‡è¶Šå¤§æˆ–æ¯”ç†±è¶Šå¤§çš„ç‰©è³ªï¼Œæº«åº¦è¶Šé›£ä¸Šå‡ï¼ˆè®ŠåŒ–è¶Šå°ï¼‰[cite: 462, 470]ã€‚"
    },
    {
        question: "ç‚ºä»€éº¼æµ·é‚Šçš„æ—¥å¤œæº«å·®é€šå¸¸æ¯”å…§é™¸åœ°å€å°ï¼Ÿ",
        options: [
            "å› ç‚ºæµ·æ°´çš„æ¯”ç†±æ¯”æ²™çŸ³å¤§ï¼Œæº«åº¦ä¸æ˜“æ”¹è®Š",
            "å› ç‚ºæµ·æ°´æœƒåå°„é™½å…‰",
            "å› ç‚ºæµ·é‚Šé¢¨æ¯”è¼ƒå¤§ï¼Œæ•£ç†±å¿«",
            "å› ç‚ºå…§é™¸åœ°å€åœ°å‹¢é€šå¸¸è¼ƒé«˜"
        ],
        correct: 0,
        [cite_start]explanation: "æ°´çš„æ¯”ç†±å¤§ (1.0)ï¼Œæ²™çŸ³æ¯”ç†±å° (ç´„0.2)ã€‚æ¯”ç†±å¤§è€…ï¼Œå¸ç†±æˆ–æ”¾ç†±æ™‚æº«åº¦è®ŠåŒ–è¼ƒå°ï¼Œå› æ­¤æµ·æ´‹å…·æœ‰èª¿ç¯€æ°£æº«çš„åŠŸèƒ½ [cite: 493, 495]ã€‚"
    }
];

let currentQuestion = 0;
let score = 0;
let isAnswered = false;

// åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', () => {
    loadQuestion();
});

function loadQuestion() {
    isAnswered = false;
    const qData = quizData[currentQuestion];
    
    // æ›´æ–°é€²åº¦æ¢
    const progress = ((currentQuestion) / quizData.length) * 100;
    document.getElementById('progress-fill').style.width = `${progress}%`;

    // è¼‰å…¥é¡Œç›®
    document.getElementById('question-text').textContent = `${currentQuestion + 1}. ${qData.question}`;
    
    // ç”¢ç”Ÿé¸é …
    const optionsContainer = document.getElementById('options-container');
    optionsContainer.innerHTML = ''; // æ¸…ç©ºèˆŠé¸é …

    qData.options.forEach((option, index) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.textContent = option;
        btn.onclick = () => checkAnswer(index, btn);
        optionsContainer.appendChild(btn);
    });

    // éš±è—å›é¥‹å€
    document.getElementById('feedback-container').classList.add('hidden');
    document.getElementById('next-btn').textContent = (currentQuestion === quizData.length - 1) ? "æŸ¥çœ‹çµæœ" : "ä¸‹ä¸€é¡Œ";
    
    // é‡æ–°æ¸²æŸ“æ•¸å­¸å…¬å¼ (MathJax)
    if (window.MathJax) {
        MathJax.typeset();
    }
}

function checkAnswer(selectedIndex, btnElement) {
    if (isAnswered) return; // é˜²æ­¢é‡è¤‡é»æ“Š
    isAnswered = true;

    const qData = quizData[currentQuestion];
    const allOptions = document.querySelectorAll('.option-btn');
    const feedbackText = document.getElementById('feedback-text');
    const explanationText = document.getElementById('explanation');

    // é–å®šæ‰€æœ‰æŒ‰éˆ•
    allOptions.forEach(btn => btn.disabled = true);

    // åˆ¤æ–·å°éŒ¯
    if (selectedIndex === qData.correct) {
        btnElement.classList.add('correct');
        feedbackText.textContent = "ç­”å°äº†ï¼ğŸ‰";
        feedbackText.style.color = "var(--correct-color)";
        score++;
    } else {
        btnElement.classList.add('wrong');
        allOptions[qData.correct].classList.add('correct'); // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ
        feedbackText.textContent = "ç­”éŒ¯äº†ã€‚";
        feedbackText.style.color = "var(--wrong-color)";
    }

    // é¡¯ç¤ºè©³è§£
    explanationText.textContent = qData.explanation;
    document.getElementById('feedback-container').classList.remove('hidden');
}

function nextQuestion() {
    currentQuestion++;
    if (currentQuestion < quizData.length) {
        loadQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    document.getElementById('quiz-area').classList.add('hidden');
    document.getElementById('result-area').classList.remove('hidden');
    
    document.getElementById('final-score').textContent = score;
    document.getElementById('total-questions').textContent = quizData.length;

    const message = document.getElementById('result-message');
    const percentage = (score / quizData.length) * 100;

    if (percentage === 100) {
        message.textContent = "å¤ªå²å®³äº†ï¼å…¨å°ï¼é€™å–®å…ƒçš„è§€å¿µä½ å·²ç¶“å®Œå…¨æŒæ¡å›‰ï¼ ğŸŒŸ";
    } else if (percentage >= 60) {
        message.textContent = "é‚„ä¸éŒ¯å–”ï¼å†è¤‡ç¿’ä¸€ä¸‹éŒ¯çš„é¡Œç›®æœƒæ›´æ£’ï¼ ğŸ’ª";
    } else {
        message.textContent = "åˆ¥æ°£é¤’ï¼Œç¿»ç¿»è¬›ç¾©é‡æ–°é‡æ¸…ä¸€ä¸‹è§€å¿µå§ï¼ ğŸ“š";
    }
}

function restartQuiz() {
    currentQuestion = 0;
    score = 0;
    document.getElementById('result-area').classList.add('hidden');
    document.getElementById('quiz-area').classList.remove('hidden');
    loadQuestion();
}